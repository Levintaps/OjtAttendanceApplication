<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TERA IT - Admin Dashboard</title>
    <link rel="stylesheet" href="admin.css">
    <link rel="stylesheet" href="notification.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
</head>
<body>
<div class="admin-layout">
    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <div class="header-left">
                <div>
                    <div class="header-title">Admin Dashboard</div>
                    <div class="header-subtitle">Intern Attendance Management System</div>
                </div>
            </div>
            <div class="header-right">
                <div class="current-time" id="currentTime">Loading...</div>
                <a href="index.html" class="back-btn">‚Üê Back to Portal</a>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('dashboard')">Dashboard</button>
            <button class="nav-tab" onclick="switchTab('students')">Students</button>
            <button class="nav-tab" onclick="switchTab('attendance')">Attendance</button>
            <button class="nav-tab" onclick="switchTab('corrections')">Corrections</button>
            <button class="nav-tab" onclick="switchTab('schedules')">Schedules</button>
            <button class="nav-tab" onclick="switchTab('liveTasks')">Live Tasks</button>
            <button class="nav-tab" onclick="switchTab('reports')">Reports</button>
            <button class="nav-tab" onclick="switchTab('notifications')">
                Notifications
                <span class="nav-notification-badge" id="navNotificationBadge">0</span>
            </button>
            <button class="nav-tab" onclick="switchTab('settings')">Settings</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="dashboard-container">
                <div class="stats-sidebar">
                    <div class="stat-card-small">
                        <h4>Total Students</h4>
                        <div class="value" id="totalStudents">-</div>
                    </div>
                    <div class="stat-card-small">
                        <h4>Currently Active</h4>
                        <div class="value" id="timedInStudents">-</div>
                    </div>
                    <div class="stat-card-small">
                        <h4>Today's Records</h4>
                        <div class="value" id="todayRecords">-</div>
                    </div>
                    <div class="stat-card-small">
                        <h4>Total Hours Today</h4>
                        <div class="value" id="totalHoursToday">-</div>
                    </div>
                </div>

                <div class="dashboard-chart">
                    <div class="chart-header">
                        <h3>Weekly Attendance Trend</h3>
                        <p>Hours logged per day over the past 7 days</p>
                    </div>
                    <div class="chart-container">
                        <canvas id="attendanceChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>Recent Activity</h3>
                    <button class="btn btn-primary" onclick="loadDashboard()">Refresh</button>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                        <tr>
                            <th>Student Name</th>
                            <th>ID Badge</th>
                            <th>Status</th>
                            <th>Time In</th>
                            <th>Time Out</th>
                            <th>Hours Today</th>
                            <th>Total Hours</th>
                        </tr>
                        </thead>
                        <tbody id="dashboardBody">
                        <tr><td colspan="7" class="loading-state">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Students Tab -->
        <div id="students" class="tab-content">
            <div class="students-layout">
                <!-- Sidebar -->
                <aside class="students-sidebar">
                    <div class="sidebar-section">
                        <h3>üìä Overview</h3>
                        <div class="sidebar-stats">
                            <div class="sidebar-stat-item">
                                <span class="sidebar-stat-label">Total</span>
                                <span class="sidebar-stat-value" id="sidebarTotalStudents">0</span>
                            </div>
                            <div class="sidebar-stat-item">
                                <span class="sidebar-stat-label">Active</span>
                                <span class="sidebar-stat-value" id="sidebarActiveStudents">0</span>
                            </div>
                            <div class="sidebar-stat-item">
                                <span class="sidebar-stat-label">Completed</span>
                                <span class="sidebar-stat-value" id="sidebarCompletedStudents">0</span>
                            </div>
                            <div class="sidebar-stat-item" style="border-left: 4px solid var(--error-color);">
                                <span class="sidebar-stat-label">üö´ Absent Today</span>
                                <span class="sidebar-stat-value" id="sidebarAbsentToday">0</span>
                            </div>
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <h3>üîç Filters</h3>
                        <div class="filter-chips">
                            <button class="filter-chip active" onclick="loadStudentsByStatusNew('all')" data-filter="all">
                                <span class="filter-chip-label">All Students</span>
                                <span class="filter-chip-count" id="chipAllCount">0</span>
                            </button>
                            <button class="filter-chip" onclick="loadStudentsByStatusNew('active')" data-filter="active">
                                <span class="filter-chip-label">Active</span>
                                <span class="filter-chip-count" id="chipActiveCount">0</span>
                            </button>
                            <button class="filter-chip" onclick="loadStudentsByStatusNew('completed')" data-filter="completed">
                                <span class="filter-chip-label">Completed</span>
                                <span class="filter-chip-count" id="chipCompletedCount">0</span>
                            </button>
                            <button class="filter-chip" onclick="loadStudentsByStatusNew('near-completion')" data-filter="near-completion">
                                <span class="filter-chip-label">Near Completion</span>
                                <span class="filter-chip-count" id="chipNearCount">0</span>
                            </button>
                            <button class="filter-chip" onclick="loadStudentsByStatusNew('absent-today')" data-filter="absent-today">
                                <span class="filter-chip-label">üö´ Absent Today</span>
                                <span class="filter-chip-count" id="chipAbsentCount">0</span>
                            </button>
                        </div>
                    </div>
                </aside>

                <!-- Content -->
                <main class="students-content">
                    <div class="page-header">
                        <div class="page-header-top">
                            <div class="page-title">
                                <h2>Student Management</h2>
                                <p>Manage student profiles, schedules, and attendance records</p>
                            </div>
                            <div class="page-actions">
                                <button class="btn btn-secondary" onclick="downloadCSVReport()">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/>
                                    </svg>
                                    Export
                                </button>
                                <button class="btn btn-primary" onclick="showRegisterStudentModal()">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="12" y1="5" x2="12" y2="19"></line>
                                        <line x1="5" y1="12" x2="19" y2="12"></line>
                                    </svg>
                                    Register Student
                                </button>
                            </div>
                        </div>

                        <div class="search-bar-container">
                            <div class="search-bar-wrapper">
                                <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="11" cy="11" r="8"></circle>
                                    <path d="m21 21-4.35-4.35"></path>
                                </svg>
                                <input type="text" class="search-bar" id="studentSearchNew" placeholder="Search by name, ID badge, or school..." onkeyup="filterStudentsNew()">
                            </div>
                        </div>
                    </div>

                    <div class="clean-table-container">
                        <table class="clean-table students-table">
                            <thead>
                            <tr>
                                <th onclick="sortStudentsTable('idBadge')">ID Badge <span class="sort-icon">‚ÜïÔ∏è</span></th>
                                <th onclick="sortStudentsTable('fullName')">Full Name <span class="sort-icon">‚ÜïÔ∏è</span></th>
                                <th>School</th>
                                <th>Status</th>
                                <th>Progress</th>
                                <th onclick="sortStudentsTable('totalHours')">Total Hours <span class="sort-icon">‚ÜïÔ∏è</span></th>
                                <th>Actions</th>
                            </tr>
                            </thead>
                            <tbody id="studentsBodyNew">
                            <tr><td colspan="7" class="loading-state">Loading...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </main>
            </div>
        </div>

        <!-- Attendance Tab -->
        <div id="attendance" class="tab-content">
            <div class="unified-layout">
                <!-- Sidebar -->
                <aside class="unified-sidebar">
                    <div class="sidebar-section">
                        <h3>üìä Quick Stats</h3>
                        <div class="sidebar-stats">
                            <div class="sidebar-stat-item">
                                <span class="sidebar-stat-label">Total Records</span>
                                <span class="sidebar-stat-value" id="sidebarTotalRecords">0</span>
                            </div>
                            <div class="sidebar-stat-item">
                                <span class="sidebar-stat-label">Total Hours</span>
                                <span class="sidebar-stat-value" id="sidebarTotalHours">0h</span>
                            </div>
                            <div class="sidebar-stat-item">
                                <span class="sidebar-stat-label">Active Students</span>
                                <span class="sidebar-stat-value" id="sidebarActiveCount">0</span>
                            </div>
                            <div class="sidebar-stat-item">
                                <span class="sidebar-stat-label">Avg Hours</span>
                                <span class="sidebar-stat-value" id="sidebarAvgHours">0h</span>
                            </div>
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <h3>üìÖ Quick Filters</h3>
                        <div class="quick-actions">
                            <button class="quick-action-btn" onclick="filterTodayNew()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                    <line x1="16" y1="2" x2="16" y2="6"></line>
                                    <line x1="8" y1="2" x2="8" y2="6"></line>
                                    <line x1="3" y1="10" x2="21" y2="10"></line>
                                </svg>
                                Today
                            </button>
                            <button class="quick-action-btn" onclick="filterYesterdayNew()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="15 18 9 12 15 6"></polyline>
                                </svg>
                                Yesterday
                            </button>
                            <button class="quick-action-btn" onclick="filterThisWeekNew()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                </svg>
                                This Week
                            </button>
                            <button class="quick-action-btn" onclick="filterThisMonthNew()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"></circle>
                                </svg>
                                This Month
                            </button>
                            <button class="quick-action-btn" onclick="filterLast7DaysNew()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                                </svg>
                                Last 7 Days
                            </button>
                            <button class="quick-action-btn" onclick="filterLast30DaysNew()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                                </svg>
                                Last 30 Days
                            </button>
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <h3>üîß Actions</h3>
                        <div class="quick-actions">
                            <button class="quick-action-btn" onclick="downloadFilteredRecordsNew()" id="sidebarDownloadBtn" style="display: none;">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/>
                                </svg>
                                Download CSV
                            </button>
                            <button class="quick-action-btn" onclick="clearAllAttendanceFiltersNew()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="18" y1="6" x2="6" y2="18"></line>
                                    <line x1="6" y1="6" x2="18" y2="18"></line>
                                </svg>
                                Clear Filters
                            </button>
                            <button class="quick-action-btn" onclick="showManualEntryModal()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                </svg>
                                Manual Entry
                            </button>
                        </div>
                    </div>
                </aside>

                <!-- Content -->
                <main class="unified-content">
                    <div class="page-header">
                        <div class="page-header-top">
                            <div class="page-title">
                                <h2>Attendance Records</h2>
                                <p>View and manage student attendance history</p>
                            </div>
                        </div>

                        <div class="compact-controls">
                            <div class="compact-control">
                                <label>Custom Date Range</label>
                                <input type="date" id="customStartDate" placeholder="Start">
                            </div>
                            <div class="compact-control">
                                <label>&nbsp;</label>
                                <input type="date" id="customEndDate" placeholder="End">
                            </div>
                            <div class="compact-control">
                                <label>Filter Status</label>
                                <select id="attendanceStatusFilterNew" onchange="applyAttendanceFiltersNew()">
                                    <option value="all">All Status</option>
                                    <option value="TIMED_IN">Currently Timed In</option>
                                    <option value="TIMED_OUT">Timed Out</option>
                                    <option value="AUTO_TIMED_OUT">Auto Timed Out</option>
                                    <option value="ADMIN_CORRECTED">Admin Corrected</option>
                                </select>
                            </div>
                            <div class="compact-control">
                                <label>&nbsp;</label>
                                <button class="btn btn-primary" onclick="applyCustomDateRange()" style="width: 100%; height: 46px;">Apply Range</button>
                            </div>
                        </div>

                        <div class="search-bar-container">
                            <div class="search-bar-wrapper">
                                <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="11" cy="11" r="8"></circle>
                                    <path d="m21 21-4.35-4.35"></path>
                                </svg>
                                <input type="text" class="search-bar" id="attendanceSearchNew" placeholder="Search by name, ID badge, or school..." onkeyup="applyAttendanceFiltersNew()">
                            </div>
                        </div>
                    </div>

                    <div class="clean-table-container">
                        <table class="clean-table">
                            <thead>
                            <tr>
                                <th>Date</th>
                                <th>Student Name</th>
                                <th>ID Badge</th>
                                <th>School</th>
                                <th>Time In</th>
                                <th>Time Out</th>
                                <th>Total Hours</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                            </thead>
                            <tbody id="attendanceBodyNew">
                            <tr>
                                <td colspan="9" class="empty-state-modern">
                                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                        <line x1="16" y1="2" x2="16" y2="6"></line>
                                        <line x1="8" y1="2" x2="8" y2="6"></line>
                                        <line x1="3" y1="10" x2="21" y2="10"></line>
                                    </svg>
                                    <h3>üìÖ Select a date range</h3>
                                    <p>Choose a date range from the sidebar to view attendance records</p>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </main>
            </div>
        </div>

        <!-- Corrections Tab -->
        <div id="corrections" class="tab-content">
            <div class="unified-layout">
                <!-- Sidebar -->
                <aside class="unified-sidebar">
                    <div class="sidebar-section">
                        <h3>üìä Overview</h3>
                        <div class="sidebar-stats">
                            <div class="sidebar-stat-item" style="border-left: 4px solid var(--error-color);">
                                <span class="sidebar-stat-label">üö® Critical (12h+)</span>
                                <span class="sidebar-stat-value" id="sidebarCriticalCorrections">0</span>
                            </div>
                            <div class="sidebar-stat-item">
                                <span class="sidebar-stat-label">Total Pending</span>
                                <span class="sidebar-stat-value" id="sidebarPendingCorrections">0</span>
                            </div>
                            <div class="sidebar-stat-item">
                                <span class="sidebar-stat-label">This Month</span>
                                <span class="sidebar-stat-value" id="sidebarMonthCorrections">0</span>
                            </div>
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <h3>‚ÑπÔ∏è Information</h3>
                        <div style="font-size: 0.85rem; line-height: 1.6; color: var(--text-secondary);">
                            <p><strong>Correction Types:</strong></p>
                            <ul style="margin: 0.5rem 0 0 1.25rem;">
                                <li><strong>üö® Critical:</strong> 12+ hours worked</li>
                                <li><strong>‚ö†Ô∏è Auto Timed Out:</strong> System timeout</li>
                                <li><strong>‚ÑπÔ∏è Incomplete:</strong> Missing data</li>
                            </ul>
                            <p style="margin-top: 0.75rem;"><small>All corrections are logged for audit purposes</small></p>
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <h3>üîß Actions</h3>
                        <div class="quick-actions">
                            <button class="quick-action-btn" onclick="loadIncompleteRecords()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="23 4 23 10 17 10"></polyline>
                                    <polyline points="1 20 1 14 7 14"></polyline>
                                    <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                                </svg>
                                Refresh List
                            </button>
                        </div>
                    </div>
                </aside>

                <!-- Content -->
                <main class="unified-content">
                    <div class="page-header">
                        <div class="page-header-top">
                            <div class="page-title">
                                <h2>Time Corrections</h2>
                                <p>Review and correct attendance records that need admin attention</p>
                            </div>
                        </div>
                    </div>

                    <div class="alert alert-info">
                        <strong>‚è∞ Time Correction System:</strong> Records listed here require manual review. Common reasons include: forgot to time out, system errors, or incomplete data.
                    </div>

                    <div id="correctionsList">
                        <div class="loading-state">Loading records that need correction...</div>
                    </div>
                </main>
            </div>
        </div>

        <!-- Schedules Tab -->
        <div id="schedules" class="tab-content">
            <div class="unified-layout">
                <!-- Sidebar -->
                <aside class="unified-sidebar">
                    <div class="sidebar-section">
                        <h3>üìä Schedule Stats</h3>
                        <div class="sidebar-stats">
                            <div class="sidebar-stat-item">
                                <span class="sidebar-stat-label">With Schedule</span>
                                <span class="sidebar-stat-value" id="sidebarWithSchedule">0</span>
                            </div>
                            <div class="sidebar-stat-item">
                                <span class="sidebar-stat-label">Without</span>
                                <span class="sidebar-stat-value" id="sidebarWithoutSchedule">0</span>
                            </div>
                            <div class="sidebar-stat-item">
                                <span class="sidebar-stat-label">Late Today</span>
                                <span class="sidebar-stat-value" id="sidebarLateToday">0</span>
                            </div>
                            <div class="sidebar-stat-item">
                                <span class="sidebar-stat-label">Compliance</span>
                                <span class="sidebar-stat-value" id="sidebarCompliance">0%</span>
                            </div>
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <h3>üîß Quick Actions</h3>
                        <div class="quick-actions">
                            <button class="quick-action-btn" onclick="loadScheduleOverview()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="23 4 23 10 17 10"></polyline>
                                    <polyline points="1 20 1 14 7 14"></polyline>
                                    <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                                </svg>
                                Refresh Overview
                            </button>
                            <button class="quick-action-btn" onclick="loadStudentsForScheduling()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="9" cy="7" r="4"></circle>
                                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                </svg>
                                Load Students Without Schedule
                            </button>
                            <button class="quick-action-btn" onclick="loadLateArrivals()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <polyline points="12 6 12 12 16 14"></polyline>
                                </svg>
                                View Late Arrivals
                            </button>
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <h3>‚ÑπÔ∏è Information</h3>
                        <div style="font-size: 0.85rem; line-height: 1.6; color: var(--text-secondary);">
                            <p><strong>Schedule Setup:</strong></p>
                            <ul style="margin: 0.5rem 0 0 1.25rem;">
                                <li>Set work hours for students</li>
                                <li>Track late arrivals</li>
                                <li>Set grace periods</li>
                                <li>Bulk assign schedules</li>
                            </ul>
                        </div>
                    </div>
                </aside>

                <!-- Content -->
                <main class="unified-content">
                    <div class="page-header">
                        <div class="page-header-top">
                            <div class="page-title">
                                <h2>Schedule Management</h2>
                                <p>Configure work schedules and track attendance patterns</p>
                            </div>
                        </div>
                    </div>

                    <!-- Schedule Overview Card -->
                    <div class="card">
                        <div class="card-header">
                            <h3>üìà Schedule Overview</h3>
                            <button class="btn btn-primary" onclick="loadScheduleOverview()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="23 4 23 10 17 10"></polyline>
                                    <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10"></path>
                                </svg>
                                Refresh
                            </button>
                        </div>
                        <div id="scheduleOverviewContent">
                            <div class="loading-state">Loading schedule overview...</div>
                        </div>
                    </div>

                    <!-- Schedule Override Requests Card -->
                    <div class="card">
                        <div class="card-header">
                            <h3>
                                üîî Schedule Override Requests
                                <span class="filter-chip-count" id="overrideBadgeCount" style="margin-left: 0.5rem;">0</span>
                            </h3>
                            <button class="btn btn-info" onclick="loadScheduleOverrideRequests()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="23 4 23 10 17 10"></polyline>
                                    <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10"></path>
                                </svg>
                                Refresh
                            </button>
                        </div>

                        <div class="alert alert-info">
                            <strong>‚ÑπÔ∏è About Schedule Overrides:</strong> Students who arrive 45+ minutes early can request approval to count those hours. Review each request and approve/reject with a message.
                        </div>

                        <div id="scheduleOverrideRequestsList">
                            <div class="loading-state">Loading schedule override requests...</div>
                        </div>
                    </div>

                    <!-- Bulk Schedule Management Card -->
                    <div class="card">
                        <div class="card-header">
                            <h3>üìã Bulk Schedule Assignment</h3>
                            <button class="btn btn-info" onclick="loadStudentsForScheduling()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="23 4 23 10 17 10"></polyline>
                                    <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10"></path>
                                </svg>
                                Load Students Without Schedule
                            </button>
                        </div>

                        <div class="alert alert-info">
                            <strong>üí° Tip:</strong> Click "Load Students Without Schedule" to see all students who don't have a schedule assigned yet. You can then select multiple students and assign schedules in bulk.
                        </div>

                        <!-- Student Selection Area -->
                        <div id="studentSelectionArea" class="d-none" style="margin-top: 1.5rem;">
                            <div style="background: var(--bg-secondary); padding: 1.25rem; border-radius: var(--border-radius-lg); margin-bottom: 1rem; border: 2px solid var(--border-color);">
                                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                                    <div>
                                        <h4 style="margin: 0 0 0.25rem 0; color: var(--text-primary);">
                                            üë• Select Students for Schedule
                                        </h4>
                                        <p style="margin: 0; font-size: 0.875rem; color: var(--text-muted);">
                                            Choose students who need schedule assignments
                                        </p>
                                    </div>
                                    <div style="display: flex; gap: 0.5rem; align-items: center;">
                                        <button class="btn btn-sm btn-secondary" onclick="selectAllStudents()">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <polyline points="20 6 9 17 4 12"></polyline>
                                            </svg>
                                            Select All
                                        </button>
                                        <button class="btn btn-sm btn-secondary" onclick="deselectAllStudents()">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                                <line x1="6" y1="6" x2="18" y2="18"></line>
                                            </svg>
                                            Deselect All
                                        </button>
                                        <div style="background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: white; padding: 0.5rem 1.25rem; border-radius: 20px; font-weight: 600; font-size: 0.875rem; box-shadow: var(--shadow-sm);">
                                            <span id="selectedCount">0</span> Selected
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Students Without Schedule Table -->
                            <div class="clean-table-container" style="margin-bottom: 1.5rem;">
                                <div class="table-header-section">
                                    <h3>üìù Students Without Assigned Schedules</h3>
                                </div>
                                <div class="table-container" style="max-height: 450px;">
                                    <table class="clean-table">
                                        <thead>
                                        <tr>
                                            <th style="width: 60px; text-align: center;">
                                                <input type="checkbox" id="selectAllCheckbox" onchange="toggleAllStudents(this)" style="width: 18px; height: 18px; cursor: pointer; accent-color: var(--primary-color);">
                                            </th>
                                            <th>ID Badge</th>
                                            <th>Full Name</th>
                                            <th>School</th>
                                            <th>Status</th>
                                            <th>Current Schedule</th>
                                        </tr>
                                        </thead>
                                        <tbody id="schedulingStudentsBody">
                                        <tr>
                                            <td colspan="6" class="empty-state-modern">
                                                <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                                    <circle cx="9" cy="7" r="4"></circle>
                                                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                                </svg>
                                                <h3>Click "Load Students Without Schedule" to begin</h3>
                                                <p>Students who need schedule assignments will appear here</p>
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- Schedule Assignment Form -->
                            <form id="bulkScheduleForm" onsubmit="submitBulkSchedule(event)">
                                <div class="form-section">
                                    <h4>‚è∞ Schedule Details</h4>
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label for="bulkStartTime">
                                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 0.25rem;">
                                                    <circle cx="12" cy="12" r="10"></circle>
                                                    <polyline points="12 6 12 12 16 14"></polyline>
                                                </svg>
                                                Start Time:
                                            </label>
                                            <input type="time" id="bulkStartTime" value="10:00" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="bulkEndTime">
                                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 0.25rem;">
                                                    <circle cx="12" cy="12" r="10"></circle>
                                                    <polyline points="12 6 12 12 16 14"></polyline>
                                                </svg>
                                                End Time:
                                            </label>
                                            <input type="time" id="bulkEndTime" value="19:00" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="bulkGracePeriod">
                                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 0.25rem;">
                                                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                                    <polyline points="22 4 12 14.01 9 11.01"></polyline>
                                                </svg>
                                                Grace Period (minutes):
                                            </label>
                                            <input type="number" id="bulkGracePeriod" min="0" max="30" value="5" required>
                                            <small>Late arrival tolerance (typically 5-15 minutes)</small>
                                        </div>
                                        <div class="form-group">
                                            <label for="bulkScheduleActive">
                                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 0.25rem;">
                                                    <polyline points="20 6 9 17 4 12"></polyline>
                                                </svg>
                                                Schedule Status:
                                            </label>
                                            <select id="bulkScheduleActive" required>
                                                <option value="true">‚úÖ Active - Enable schedule tracking</option>
                                                <option value="false">‚è∏Ô∏è Inactive - Save but don't track yet</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <div class="alert alert-warning" id="scheduleSelectionWarning" style="display: none;">
                                    <strong>‚ö†Ô∏è No students selected!</strong> Please select at least one student from the table above by checking the boxes.
                                </div>

                                <div class="modal-actions" style="margin-top: 1.5rem;">
                                    <button type="button" class="btn btn-secondary" onclick="clearBulkScheduleForm()">
                                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <line x1="18" y1="6" x2="6" y2="18"></line>
                                            <line x1="6" y1="6" x2="18" y2="18"></line>
                                        </svg>
                                        Clear Form
                                    </button>
                                    <button type="submit" class="btn btn-warning" id="applyScheduleBtn" disabled>
                                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="20 6 9 17 4 12"></polyline>
                                        </svg>
                                        Apply Schedule to Selected Students
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Late Arrivals Card -->
                    <div class="card">
                        <div class="card-header">
                            <h3>‚è∞ Today's Late Arrivals</h3>
                            <button class="btn btn-info" onclick="loadLateArrivals()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="23 4 23 10 17 10"></polyline>
                                    <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10"></path>
                                </svg>
                                Refresh
                            </button>
                        </div>
                        <div class="clean-table-container">
                            <table class="clean-table">
                                <thead>
                                <tr>
                                    <th>Student Name</th>
                                    <th>ID Badge</th>
                                    <th>Scheduled Time</th>
                                    <th>Actual Time In</th>
                                    <th>Minutes Late</th>
                                    <th>Actions</th>
                                </tr>
                                </thead>
                                <tbody id="lateArrivalsBody">
                                <tr><td colspan="6" class="loading-state">Loading...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </main>
            </div>
        </div>

        <!-- Live Tasks Tab -->
        <div id="liveTasks" class="tab-content">
            <div class="unified-layout">
                <!-- Sidebar -->
                <aside class="unified-sidebar">
                    <div class="sidebar-section">
                        <h3>üìä Activity Stats</h3>
                        <div class="sidebar-stats">
                            <div class="sidebar-stat-item">
                                <span class="sidebar-stat-label">Active</span>
                                <span class="sidebar-stat-value" id="statTotalActive">0</span>
                            </div>
                            <div class="sidebar-stat-item">
                                <span class="sidebar-stat-label">üü¢ Very Active</span>
                                <span class="sidebar-stat-value" id="statVeryActive">0</span>
                            </div>
                            <div class="sidebar-stat-item">
                                <span class="sidebar-stat-label">üü° Active</span>
                                <span class="sidebar-stat-value" id="statActive">0</span>
                            </div>
                            <div class="sidebar-stat-item">
                                <span class="sidebar-stat-label">üî¥ Idle</span>
                                <span class="sidebar-stat-value" id="statIdle">0</span>
                            </div>
                            <div class="sidebar-stat-item">
                                <span class="sidebar-stat-label">Total Tasks</span>
                                <span class="sidebar-stat-value" id="statTotalTasks">0</span>
                            </div>
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <h3>üîß Card Controls</h3>
                        <div class="quick-actions">
                            <button class="quick-action-btn" onclick="expandAllTaskCards()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="6 9 12 15 18 9"></polyline>
                                </svg>
                                Expand All
                            </button>
                            <button class="quick-action-btn" onclick="collapseAllTaskCards()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="18 15 12 9 6 15"></polyline>
                                </svg>
                                Collapse All
                            </button>
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <h3>üîß Actions</h3>
                        <div class="quick-actions">
                            <button class="quick-action-btn" id="autoRefreshToggle" onclick="toggleAutoRefresh()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="23 4 23 10 17 10"></polyline>
                                    <polyline points="1 20 1 14 7 14"></polyline>
                                    <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                                </svg>
                                Auto-Refresh: ON
                            </button>
                            <button class="quick-action-btn" onclick="loadLiveTaskUpdates()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="23 4 23 10 17 10"></polyline>
                                    <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10"></path>
                                </svg>
                                Refresh Now
                            </button>
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <h3>üïê Last Updated</h3>
                        <div style="text-align: center; padding: 1rem; background: var(--bg-secondary); border-radius: var(--border-radius-lg);">
                            <div style="font-size: 1.25rem; font-weight: 600; color: var(--text-primary);" id="lastRefreshTime">Never</div>
                        </div>
                    </div>
                </aside>

                <!-- Content -->
                <main class="unified-content">
                    <div class="page-header">
                        <div class="page-header-top">
                            <div class="page-title">
                                <h2>üìã Real-Time Task Monitoring</h2>
                                <p>Track student productivity and task completion in real-time</p>
                            </div>
                        </div>

                        <div class="compact-controls">
                            <div class="compact-control">
                                <label>Sort By</label>
                                <select id="taskSortSelect" onchange="displayLiveTaskCards()">
                                    <option value="recent">Most Recent Activity</option>
                                    <option value="tasks">Most Tasks</option>
                                    <option value="name">Name (A-Z)</option>
                                    <option value="time">Longest Working Time</option>
                                </select>
                            </div>
                            <div class="compact-control">
                                <label>Filter Productivity</label>
                                <select id="productivityFilter" onchange="filterLiveTasks()">
                                    <option value="all">All Students</option>
                                    <option value="very-active">Very Active Only</option>
                                    <option value="active">Active Only</option>
                                    <option value="idle">Idle Only</option>
                                    <option value="new">Just Started</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="task-cards-grid" id="liveTaskCardsContainer">
                        <div class="loading-state" style="grid-column: 1 / -1;">
                            <h3>Loading live task updates...</h3>
                        </div>
                    </div>
                </main>
            </div>
        </div>

        <!-- Reports Tab -->
        <div id="reports" class="tab-content">
            <div class="unified-layout">
                <!-- Sidebar -->
                <aside class="unified-sidebar">
                    <div class="sidebar-section">
                        <h3>üìä Quick Stats</h3>
                        <div class="sidebar-stats">
                            <div class="sidebar-stat-item">
                                <span class="sidebar-stat-label">Total Students</span>
                                <span class="sidebar-stat-value" id="reportTotalStudents">0</span>
                            </div>
                            <div class="sidebar-stat-item">
                                <span class="sidebar-stat-label">Active Students</span>
                                <span class="sidebar-stat-value" id="reportActiveStudents">0</span>
                            </div>
                            <div class="sidebar-stat-item">
                                <span class="sidebar-stat-label">Total Records</span>
                                <span class="sidebar-stat-value" id="reportTotalRecords">0</span>
                            </div>
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <h3>üöÄ Quick Reports</h3>
                        <div class="quick-actions">
                            <button class="quick-action-btn" onclick="generateTodayReport()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                    <line x1="16" y1="2" x2="16" y2="6"></line>
                                    <line x1="8" y1="2" x2="8" y2="6"></line>
                                    <line x1="3" y1="10" x2="21" y2="10"></line>
                                </svg>
                                Today's Attendance
                            </button>
                            <button class="quick-action-btn" onclick="generateWeekReport()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                </svg>
                                This Week
                            </button>
                            <button class="quick-action-btn" onclick="generateMonthReport()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"></circle>
                                </svg>
                                This Month
                            </button>
                            <button class="quick-action-btn" onclick="downloadStudentsCSV()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="9" cy="7" r="4"></circle>
                                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                </svg>
                                All Students CSV
                            </button>
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <h3>‚ÑπÔ∏è Information</h3>
                        <div style="font-size: 0.85rem; line-height: 1.6; color: var(--text-secondary);">
                            <p><strong>Report Types:</strong></p>
                            <ul style="margin: 0.5rem 0 0 1.25rem;">
                                <li><strong>Student Reports:</strong> Student profiles & progress</li>
                                <li><strong>Attendance Reports:</strong> Time records & history</li>
                                <li><strong>Individual Reports:</strong> Single student data</li>
                            </ul>
                        </div>
                    </div>
                </aside>

                <!-- Content -->
                <main class="unified-content">
                    <div class="page-header">
                        <div class="page-header-top">
                            <div class="page-title">
                                <h2>üìà Reports & Data Export</h2>
                                <p>Generate and download various reports in CSV or Excel format</p>
                            </div>
                        </div>
                    </div>

                    <!-- Student Reports Card -->
                    <div class="card">
                        <div class="card-header">
                            <h3>üë• Student Reports</h3>
                            <button class="btn btn-info" onclick="updateReportStats()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="23 4 23 10 17 10"></polyline>
                                    <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10"></path>
                                </svg>
                                Refresh Stats
                            </button>
                        </div>

                        <div class="alert alert-info">
                            <strong>üí° Student Reports Include:</strong> ID Badge, Name, School, Status, Required Hours, Total Hours, Progress, Schedule Information
                        </div>

                        <div class="report-options-grid">
                            <!-- All Students Export -->
                            <div class="report-option-card">
                                <div class="report-option-header">
                                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                        <circle cx="9" cy="7" r="4"></circle>
                                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                    </svg>
                                    <h4>All Students</h4>
                                </div>
                                <p>Export complete student database with all information including progress and schedules</p>
                                <button class="btn btn-success btn-block" onclick="downloadStudentsCSV()">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/>
                                    </svg>
                                    Download Students CSV
                                </button>
                            </div>

                            <!-- Active Students Only -->
                            <div class="report-option-card">
                                <div class="report-option-header">
                                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                        <polyline points="22 4 12 14.01 9 11.01"></polyline>
                                    </svg>
                                    <h4>Active Students Only</h4>
                                </div>
                                <p>Export only active students (excludes completed and inactive)</p>
                                <button class="btn btn-success btn-block" onclick="downloadActiveStudentsCSV()">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/>
                                    </svg>
                                    Download Active Students
                                </button>
                            </div>

                            <!-- Students with Progress -->
                            <div class="report-option-card">
                                <div class="report-option-header">
                                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="12" y1="1" x2="12" y2="23"></line>
                                        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                                    </svg>
                                    <h4>Progress Report</h4>
                                </div>
                                <p>Detailed progress report with completion percentages and hours remaining</p>
                                <button class="btn btn-success btn-block" onclick="downloadProgressReport()">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/>
                                    </svg>
                                    Download Progress Report
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Attendance Reports Card -->
                    <div class="card">
                        <div class="card-header">
                            <h3>üìÖ Attendance Reports</h3>
                        </div>

                        <div class="alert alert-info">
                            <strong>üí° Attendance Reports Include:</strong> Date, Student Name, ID Badge, School, Time In/Out, Total Hours, Status
                        </div>

                        <div class="form-section">
                            <h4>üìÜ Date Range Selection</h4>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="reportStartDate">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 0.25rem;">
                                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                            <line x1="16" y1="2" x2="16" y2="6"></line>
                                            <line x1="8" y1="2" x2="8" y2="6"></line>
                                            <line x1="3" y1="10" x2="21" y2="10"></line>
                                        </svg>
                                        Start Date:
                                    </label>
                                    <input type="date" id="reportStartDate" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="reportEndDate">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 0.25rem;">
                                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                            <line x1="16" y1="2" x2="16" y2="6"></line>
                                            <line x1="8" y1="2" x2="8" y2="6"></line>
                                            <line x1="3" y1="10" x2="21" y2="10"></line>
                                        </svg>
                                        End Date:
                                    </label>
                                    <input type="date" id="reportEndDate" class="form-control">
                                </div>
                            </div>
                            <div class="action-buttons">
                                <button class="btn btn-success" onclick="downloadCSVReport()">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/>
                                    </svg>
                                    Download CSV
                                </button>
                                <button class="btn btn-info" onclick="downloadExcelReport()">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/>
                                    </svg>
                                    Download Excel
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Individual Student Report Card -->
                    <div class="card">
                        <div class="card-header">
                            <h3>üë§ Individual Student Report</h3>
                        </div>

                        <div class="alert alert-info">
                            <strong>üí° Individual Reports Include:</strong> Complete attendance history and detailed time records for a specific student
                        </div>

                        <div class="form-section">
                            <h4>üîç Student Selection</h4>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="studentReportStart">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 0.25rem;">
                                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                        </svg>
                                        Start Date:
                                    </label>
                                    <input type="date" id="studentReportStart">
                                </div>
                                <div class="form-group">
                                    <label for="studentReportEnd">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 0.25rem;">
                                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                        </svg>
                                        End Date:
                                    </label>
                                    <input type="date" id="studentReportEnd">
                                </div>
                                <div class="form-group">
                                    <label for="reportStudentId">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 0.25rem;">
                                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                            <circle cx="12" cy="7" r="4"></circle>
                                        </svg>
                                        Student ID Badge:
                                    </label>
                                    <input type="text" id="reportStudentId" placeholder="Enter 4-digit ID" maxlength="4">
                                </div>
                            </div>
                            <div class="action-buttons">
                                <button class="btn btn-primary" onclick="downloadStudentReport()">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/>
                                    </svg>
                                    Download Student Report
                                </button>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>

        <!-- Notifications Tab -->
        <div id="notifications" class="tab-content">
            <div class="unified-layout">
                <!-- Sidebar -->
                <aside class="unified-sidebar">
                    <div class="sidebar-section">
                        <h3>üìä Overview</h3>
                        <div class="sidebar-stats">
                            <div class="sidebar-stat-item">
                                <span class="sidebar-stat-label">Total</span>
                                <span class="sidebar-stat-value" id="sidebarNotifTotal">0</span>
                            </div>
                            <div class="sidebar-stat-item">
                                <span class="sidebar-stat-label">Unread</span>
                                <span class="sidebar-stat-value" id="sidebarNotifUnread">0</span>
                            </div>
                            <div class="sidebar-stat-item">
                                <span class="sidebar-stat-label">Read</span>
                                <span class="sidebar-stat-value" id="sidebarNotifRead">0</span>
                            </div>
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <h3>üîç Filters</h3>
                        <div class="filter-chips">
                            <button class="filter-chip active" onclick="filterNotificationsTab('all')" data-filter="all">
                                <span class="filter-chip-label">All</span>
                                <span class="filter-chip-count" id="filterAllCountTab">0</span>
                            </button>
                            <button class="filter-chip" onclick="filterNotificationsTab('unread')" data-filter="unread">
                                <span class="filter-chip-label">Unread</span>
                                <span class="filter-chip-count" id="filterUnreadCountTab">0</span>
                            </button>
                            <button class="filter-chip" onclick="filterNotificationsTab('read')" data-filter="read">
                                <span class="filter-chip-label">Read</span>
                                <span class="filter-chip-count" id="filterReadCountTab">0</span>
                            </button>
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <h3>üîß Actions</h3>
                        <div class="quick-actions">
                            <button class="quick-action-btn" onclick="loadNotificationsTab()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="23 4 23 10 17 10"></polyline>
                                    <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10"></path>
                                </svg>
                                Refresh
                            </button>
                            <button class="quick-action-btn" onclick="markAllNotificationsReadTab()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="20 6 9 17 4 12"></polyline>
                                </svg>
                                Mark All Read
                            </button>
                            <button class="quick-action-btn" onclick="clearReadNotificationsTab()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="18" y1="6" x2="6" y2="18"></line>
                                    <line x1="6" y1="6" x2="18" y2="18"></line>
                                </svg>
                                Clear Read
                            </button>
                            <button class="quick-action-btn" onclick="cleanupOldNotificationsTab()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"></path>
                                </svg>
                                Cleanup Old
                            </button>
                        </div>
                    </div>
                </aside>

                <!-- Content -->
                <main class="unified-content">
                    <div class="page-header">
                        <div class="page-header-top">
                            <div class="page-title">
                                <h2>üîî Notifications</h2>
                                <p>View and manage system notifications</p>
                            </div>
                            <button class="btn btn-error" onclick="clearAllNotificationsTab()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="3 6 5 6 21 6"></polyline>
                                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                </svg>
                                Clear All
                            </button>
                        </div>
                    </div>

                    <div id="notificationsTabContent" class="card">
                        <div class="notification-loading">
                            <div class="spinner"></div>
                            <p>Loading notifications...</p>
                        </div>
                    </div>
                </main>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h3>üîê Security Settings</h3>
                </div>

                <div class="student-detail">
                    <h4>Admin Password Management</h4>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <div class="detail-label">Username</div>
                            <div class="detail-value">admin</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Last Password Change</div>
                            <div class="detail-value" id="passwordLastChanged">Loading...</div>
                        </div>
                    </div>
                </div>

                <div class="alert alert-info">
                    <strong>üõ°Ô∏è Security Recommendations:</strong>
                    <ul style="margin: 0.5rem 0 0 1.5rem; line-height: 1.8;">
                        <li>Use a strong password with at least 8 characters</li>
                        <li>Include uppercase, lowercase, numbers, and special characters</li>
                        <li>Change your password regularly (every 90 days recommended)</li>
                        <li>Never share your admin credentials</li>
                    </ul>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-warning" onclick="showChangePasswordModal()">
                        üîë Change Password
                    </button>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>‚ÑπÔ∏è System Information</h3>
                </div>
                <div class="student-detail">
                    <h4>Application Details</h4>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <div class="detail-label">System Name</div>
                            <div class="detail-value">TERA OJT Attendance System</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Version</div>
                            <div class="detail-value">2.1.5</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">API Status</div>
                            <div class="detail-value">
                                <span class="status-badge status-active">Online</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Change Password Modal -->
        <div id="changePasswordModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>üîë Change Admin Password</h3>
                    <button class="modal-close" onclick="closeModal('changePasswordModal')">√ó</button>
                </div>

                <form id="changePasswordForm" onsubmit="submitChangePassword(event)">
                    <div class="form-group">
                        <label for="currentPassword">Current Password:</label>
                        <input type="password" id="currentPassword" placeholder="Enter current password"
                               required autocomplete="current-password">
                    </div>

                    <div class="form-group">
                        <label for="newPassword">New Password:</label>
                        <input type="password" id="newPassword" placeholder="Enter new password (min 8 characters)"
                               minlength="8" required autocomplete="new-password">
                        <small>Must be at least 8 characters long</small>
                    </div>

                    <div class="form-group">
                        <label for="confirmPassword">Confirm New Password:</label>
                        <input type="password" id="confirmPassword" placeholder="Re-enter new password"
                               minlength="8" required autocomplete="new-password">
                    </div>

                    <div class="alert alert-warning">
                        <strong>‚ö†Ô∏è Important:</strong> After changing your password, you'll need to use the new password for future logins.
                    </div>

                    <div class="modal-actions">
                        <button type="button" class="btn btn-secondary" onclick="generateSecurePassword()">
                            üé≤ Generate Secure Password
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="closeModal('changePasswordModal')">
                            Cancel
                        </button>
                        <button type="submit" class="btn btn-warning">
                            üíæ Change Password
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modals -->
<div id="studentViewModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Student Details</h3>
            <button class="modal-close" onclick="closeModal('studentViewModal')">√ó</button>
        </div>
        <div id="studentViewContent"></div>
    </div>
</div>

<div id="attendanceViewModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Attendance Record Details</h3>
            <button class="modal-close" onclick="closeModal('attendanceViewModal')">√ó</button>
        </div>
        <div id="attendanceViewContent"></div>
    </div>
</div>

<div id="timeCorrectionModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>‚è∞ Time Correction</h3>
            <button class="modal-close" onclick="closeModal('timeCorrectionModal')">√ó</button>
        </div>

        <div id="correctionDetails"></div>

        <form id="timeCorrectionForm" onsubmit="submitTimeCorrection(event)">
            <div class="form-group">
                <label for="correctedHours">Corrected Hours (0-16):</label>
                <input type="number"
                       id="correctedHours"
                       min="0"
                       max="16"
                       step="0.5"
                       placeholder="Enter hours worked (e.g., 8.5)"
                       required>
                <small>Enter the actual number of hours the student worked</small>
            </div>

            <div class="form-group">
                <label for="correctionReason">Correction Reason:</label>
                <textarea id="correctionReason"
                          placeholder="Explain why this correction is needed (e.g., 'Student forgot to time out', 'System error')"
                          rows="3"
                          required></textarea>
                <small>This will be logged for audit purposes</small>
            </div>

            <div class="alert alert-info">
                <strong>‚ÑπÔ∏è Note:</strong> This correction will be recorded and marked as admin-corrected in the system.
            </div>

            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="closeModal('timeCorrectionModal')">
                    Cancel
                </button>
                <button type="submit" class="btn btn-warning">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                    Apply Correction
                </button>
            </div>
        </form>
    </div>
</div>

<div id="badgeManagementModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Change Student Badge</h3>
            <button class="modal-close" onclick="closeModal('badgeManagementModal')">√ó</button>
        </div>
        <div id="badgeStudentInfo"></div>
        <form id="badgeManagementForm" onsubmit="submitBadgeChange(event)">
            <div class="form-group">
                <label for="newBadgeId">New Badge ID:</label>
                <input type="text" id="newBadgeId" placeholder="4-digit ID" maxlength="4" required>
                <div id="newBadgeValidation"></div>
            </div>
            <div class="alert alert-warning">
                <strong>Warning:</strong> Changing a student's badge will update their login credentials.
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="closeModal('badgeManagementModal')">Cancel</button>
                <button type="submit" class="btn btn-warning">Update Badge</button>
            </div>
        </form>
    </div>
</div>

<!-- Reset TOTP Modal -->
<div class="modal" id="resetTotpModal">
    <div class="modal-content modal-medium">
        <div class="modal-header">
            <h3>
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; color: var(--warning-color);">
                    <path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"></path>
                </svg>
                Reset TOTP Authentication
            </h3>
            <button class="modal-close" onclick="closeModal('resetTotpModal')">&times;</button>
        </div>

        <div class="modal-body">
            <div class="alert alert-warning">
                <strong>‚ö†Ô∏è Emergency TOTP Reset</strong>
                <p>This action will reset the student's Two-Factor Authentication and allow them to set up a new device.</p>
            </div>

            <div id="resetTotpStudentInfo" class="student-detail"></div>

            <form id="resetTotpForm" onsubmit="submitResetTotp(event)">
                <div class="form-group">
                    <label for="resetTotpReason">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle;">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                        </svg>
                        Reason for Reset: <span class="required">*</span>
                    </label>
                    <textarea
                            id="resetTotpReason"
                            rows="4"
                            placeholder="e.g., Student lost their phone, Device stolen, New phone..."
                            required
                            minlength="10"
                            maxlength="500"></textarea>
                    <small>Please provide a detailed reason for this reset (minimum 10 characters)</small>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="confirmResetTotp" required style="width: auto; margin-right: 0.5rem;">
                        I confirm that this is an emergency situation and the student needs TOTP reset
                    </label>
                </div>

                <div class="alert alert-info">
                    <strong>üì± What happens after reset:</strong>
                    <ul style="margin: 0.5rem 0 0 1.5rem;">
                        <li>Student's TOTP will be completely disabled</li>
                        <li>Student can time in/out without TOTP temporarily</li>
                        <li>Student must set up TOTP again on their next login</li>
                        <li>This action will be logged for audit purposes</li>
                    </ul>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('resetTotpModal')">Cancel</button>
                    <button type="submit" class="btn btn-warning">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="1 4 1 10 7 10"></polyline>
                            <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
                        </svg>
                        Reset TOTP
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Reset TOTP Confirmation Modal -->
<div class="modal" id="resetTotpConfirmModal">
    <div class="modal-content modal-small">
        <div class="modal-body" style="text-align: center; padding: 2rem;">
            <div id="resetTotpConfirmContent"></div>
        </div>
    </div>
</div>

<div id="hoursManagementModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Set Required Hours</h3>
            <button class="modal-close" onclick="closeModal('hoursManagementModal')">√ó</button>
        </div>
        <div id="hoursStudentInfo"></div>
        <form id="hoursManagementForm" onsubmit="submitHoursChange(event)">
            <div class="form-group">
                <label for="newRequiredHours">Required Hours:</label>
                <input type="number" id="newRequiredHours" min="1" max="2000" required>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="closeModal('hoursManagementModal')">Cancel</button>
                <button type="submit" class="btn btn-primary">Set Hours</button>
            </div>
        </form>
    </div>
</div>

<div id="statusManagementModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Change Student Status</h3>
            <button class="modal-close" onclick="closeModal('statusManagementModal')">√ó</button>
        </div>
        <div id="statusStudentInfo"></div>
        <form id="statusManagementForm" onsubmit="submitStatusChange(event)">
            <div class="form-group">
                <label for="newStudentStatus">New Status:</label>
                <select id="newStudentStatus" required>
                    <option value="">Select Status</option>
                    <option value="ACTIVE">ACTIVE</option>
                    <option value="COMPLETED">COMPLETED</option>
                    <option value="INACTIVE">INACTIVE</option>
                </select>
            </div>
            <div id="completionWarning" class="alert alert-warning d-none">
                <strong>Warning:</strong> Marking as COMPLETED will release their badge for reuse.
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="closeModal('statusManagementModal')">Cancel</button>
                <button type="submit" class="btn btn-primary" id="statusSubmitBtn">Update Status</button>
            </div>
        </form>
    </div>
</div>

<div id="deleteStudentModal" class="modal">
    <div class="modal-content modal-lg">
        <div class="modal-header">
            <h3>
                üóëÔ∏è Remove Student
            </h3>
            <button class="modal-close" onclick="closeModal('deleteStudentModal')">√ó</button>
        </div>

        <div id="deleteStudentInfo">
            <!-- Content will be dynamically loaded by showDeleteStudentModal() -->
        </div>

        <form id="deleteStudentForm" onsubmit="submitDeleteStudent(event)">
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="closeModal('deleteStudentModal')">Cancel</button>
                <button type="submit" class="btn btn-warning" id="deleteSubmitBtn">Deactivate Student</button>
            </div>
        </form>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteConfirmationModal" class="modal">
    <div class="modal-content">
        <div class="modal-header" style="border-bottom: none; padding-bottom: 0;">
            <button class="modal-close" onclick="closeModal('deleteConfirmationModal')" style="position: absolute; right: 1.5rem; top: 1.5rem;">√ó</button>
        </div>

        <div id="deleteConfirmationContent">
            <!-- Content will be dynamically loaded -->
        </div>

        <div class="modal-actions" style="margin-top: 2rem; padding-top: 1.5rem; border-top: 2px solid var(--border-color);">
            <button class="btn btn-secondary" onclick="closeModal('deleteConfirmationModal')">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
                Cancel
            </button>
            <button class="btn btn-warning" id="confirmDeleteBtn" onclick="executeDeleteAction()">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
                Confirm Action
            </button>
        </div>
    </div>
</div>

<div id="studentProgressModal" class="modal">
    <div class="modal-content modal-lg">
        <div class="modal-header">
            <h3>Student Progress Details</h3>
            <button class="modal-close" onclick="closeModal('studentProgressModal')">√ó</button>
        </div>
        <div id="studentProgressContent"></div>
    </div>
</div>

<div id="scheduleManagementModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Manage Student Schedule</h3>
            <button class="modal-close" onclick="closeModal('scheduleManagementModal')">√ó</button>
        </div>
        <div id="scheduleStudentInfo"></div>
        <form id="scheduleManagementForm" onsubmit="submitScheduleChange(event)">
            <div class="form-group">
                <label for="scheduleStartTime">Start Time:</label>
                <input type="time" id="scheduleStartTime" required>
            </div>
            <div class="form-group">
                <label for="scheduleEndTime">End Time:</label>
                <input type="time" id="scheduleEndTime" required>
            </div>
            <div class="form-group">
                <label for="gracePeriodMinutes">Grace Period (minutes):</label>
                <input type="number" id="gracePeriodMinutes" min="0" max="30" value="5" required>
            </div>
            <div class="form-group">
                <label for="scheduleActive">Active Schedule:</label>
                <select id="scheduleActive" required>
                    <option value="true">Yes</option>
                    <option value="false">No</option>
                </select>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="closeModal('scheduleManagementModal')">Cancel</button>
                <button type="submit" class="btn btn-primary">Update Schedule</button>
            </div>
        </form>
    </div>
</div>

<div id="allTasksModal" class="modal">
    <div class="modal-content modal-lg">
        <div class="modal-header">
            <h3>üìã Complete Task List</h3>
            <button class="modal-close" onclick="closeModal('allTasksModal')">√ó</button>
        </div>
        <div id="allTasksContent">
            <div class="loading-state">Loading tasks...</div>
        </div>
    </div>
</div>

<div id="studentRegistrationModal" class="modal">
    <div class="modal-content modal-lg">
        <div class="modal-header">
            <h3>üìù Register New Student</h3>
            <button class="modal-close" onclick="closeModal('studentRegistrationModal')">√ó</button>
        </div>

        <form id="studentRegistrationFormNew" onsubmit="registerStudentWithSchedule(event)">
            <div class="form-section">
                <h4>üë§ Student Information</h4>

                <div class="form-grid">
                    <div class="form-group">
                        <label for="regIdBadgeNew">ID Badge Number:</label>
                        <input type="text" id="regIdBadgeNew" placeholder="4-digit ID" maxlength="4" required oninput="this.value = this.value.replace(/\D/g, '').slice(0, 4); if(this.value.length === 4) { validateManualBadge(this.value); } else { document.getElementById('regBadgeValidation').innerHTML = ''; }">
                        <div id="regBadgeValidation"></div>
                    </div>

                    <div class="form-group">
                        <label for="regFullNameNew">Full Name:</label>
                        <input type="text" id="regFullNameNew" placeholder="Lastname, Firstname MI" required>
                    </div>

                    <div class="form-group">
                        <label for="regSchoolNew">School/University:</label>
                        <input type="text" id="regSchoolNew" placeholder="Enter school name" required>
                    </div>

                    <div class="form-group">
                        <label for="regRequiredHoursNew">Required Hours:</label>
                        <input type="number" id="regRequiredHoursNew" placeholder="e.g., 480" min="1" max="2000" required>
                        <small>Typical OJT programs: 240-600 hours</small>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h4>üìÖ Work Schedule (Optional)</h4>

                <div class="alert alert-info">
                    <strong>‚ÑπÔ∏è Schedule Information:</strong> Setting a schedule helps track late arrivals.
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label for="regStartTimeNew">Start Time:</label>
                        <input type="time" id="regStartTimeNew" value="10:00">
                    </div>

                    <div class="form-group">
                        <label for="regEndTimeNew">End Time:</label>
                        <input type="time" id="regEndTimeNew" value="19:00">
                    </div>

                    <div class="form-group">
                        <label for="regGracePeriodNew">Grace Period (minutes):</label>
                        <input type="number" id="regGracePeriodNew" value="5" min="0" max="30">
                    </div>

                    <div class="form-group">
                        <label for="regScheduleActiveNew">Activate Schedule:</label>
                        <select id="regScheduleActiveNew">
                            <option value="true">Yes - Enable schedule tracking</option>
                            <option value="false">No - Set schedule later</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="closeModal('studentRegistrationModal')">Cancel</button>
                <button type="button" class="btn btn-secondary" onclick="clearRegistrationFormNew()">Clear Form</button>
                <button type="submit" class="btn btn-success">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                    Register Student
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Cleanup Notifications Modal -->
<div id="cleanupNotificationsModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>
                üßπ Cleanup Old Notifications
            </h3>
            <button class="modal-close" onclick="closeModal('cleanupNotificationsModal')">√ó</button>
        </div>

        <div class="cleanup-info">
            <h4>What will be deleted?</h4>
            <ul>
                <li>All notifications older than the specified number of days</li>
                <li>Both read and unread notifications will be removed</li>
                <li>This action cannot be undone</li>
            </ul>
        </div>

        <form id="cleanupNotificationsForm" onsubmit="submitCleanupNotifications(event)">
            <div class="form-group">
                <label for="cleanupDays">Delete notifications older than:</label>
                <input type="number"
                       id="cleanupDays"
                       min="1"
                       max="365"
                       value="30"
                       required>
                <small>Enter number of days (1-365)</small>
            </div>

            <div class="cleanup-preview">
                <div class="cleanup-preview-item">
                    <span class="cleanup-preview-label">Typical options:</span>
                    <span class="cleanup-preview-value"></span>
                </div>
                <div class="cleanup-preview-item">
                    <button type="button" class="btn btn-sm btn-secondary" onclick="document.getElementById('cleanupDays').value='7'">7 days</button>
                    <button type="button" class="btn btn-sm btn-secondary" onclick="document.getElementById('cleanupDays').value='30'">30 days</button>
                    <button type="button" class="btn btn-sm btn-secondary" onclick="document.getElementById('cleanupDays').value='90'">90 days</button>
                </div>
            </div>

            <div class="alert alert-warning">
                <strong>‚ö†Ô∏è Warning:</strong> This action will permanently delete all matching notifications and cannot be undone.
            </div>

            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="closeModal('cleanupNotificationsModal')">Cancel</button>
                <button type="submit" class="btn btn-warning">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="3 6 5 6 21 6"></polyline>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                    </svg>
                    Cleanup Notifications
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Clear All Notifications Confirmation Modal -->
<div id="clearAllNotificationsModal" class="modal">
    <div class="modal-content">
        <div class="modal-header" style="border-bottom: none; padding-bottom: 0;">
            <button class="modal-close" onclick="closeModal('clearAllNotificationsModal')" style="position: absolute; right: 1.5rem; top: 1.5rem;">√ó</button>
        </div>

        <div class="confirm-entry-card hard-delete">
            <div class="confirm-header critical">
                <div class="confirm-icon danger">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                        <line x1="12" y1="9" x2="12" y2="13"></line>
                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                    </svg>
                </div>
                <h3>üö® DELETE ALL NOTIFICATIONS</h3>
                <p>This action will permanently delete every notification</p>
            </div>

            <div class="confirm-details">
                <div class="detail-row">
                    <span class="detail-label">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                        </svg>
                        Total Notifications
                    </span>
                    <span class="detail-value" id="clearAllTotalCount">0</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="8" x2="12" y2="12"></line>
                            <line x1="12" y1="16" x2="12.01" y2="16"></line>
                        </svg>
                        Unread Notifications
                    </span>
                    <span class="detail-value" id="clearAllUnreadCount">0</span>
                </div>
            </div>

            <div class="confirm-warning critical">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                    <line x1="12" y1="9" x2="12" y2="13"></line>
                    <line x1="12" y1="17" x2="12.01" y2="17"></line>
                </svg>
                <div class="confirm-warning-content">
                    <strong>üö® CRITICAL WARNING</strong>
                    <p>This will permanently delete:</p>
                    <ul>
                        <li><strong>ALL notifications</strong> (read and unread)</li>
                        <li><strong>Complete notification history</strong></li>
                        <li><strong>System alerts and warnings</strong></li>
                        <li><strong>Audit trail entries</strong></li>
                    </ul>
                    <p style="margin-top: 0.75rem;">
                        <strong style="color: var(--error-color);">THIS CANNOT BE RECOVERED!</strong>
                    </p>
                </div>
            </div>

            <div class="badge-verification-section">
                <div class="form-group">
                    <label for="clearAllConfirmInput">
                        Type <span class="badge-highlight">DELETE ALL</span> to confirm:
                    </label>
                    <input
                            type="text"
                            id="clearAllConfirmInput"
                            placeholder="Type DELETE ALL to confirm"
                            autocomplete="off"
                            style="text-transform: uppercase;"
                    >
                </div>
            </div>
        </div>

        <div class="modal-actions" style="margin-top: 2rem; padding-top: 1.5rem; border-top: 2px solid var(--border-color);">
            <button class="btn btn-secondary" onclick="closeModal('clearAllNotificationsModal')">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
                Cancel
            </button>
            <button class="btn btn-error" onclick="executeClearAllNotifications()">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="3 6 5 6 21 6"></polyline>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                </svg>
                Yes, Permanently Delete All
            </button>
        </div>
    </div>
</div>

<!-- Manual Attendance Entry Modal -->
<div id="manualEntryModal" class="modal">
    <div class="modal-content modal-lg">
        <div class="modal-header">
            <h3>
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 0.5rem;">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
                Manual Attendance Entry
            </h3>
            <button class="modal-close" onclick="closeModal('manualEntryModal')">√ó</button>
        </div>

        <div class="alert alert-info">
            <strong>‚ÑπÔ∏è Manual Entry Purpose:</strong> Use this to create attendance records when students forget to time-in/out, or when system issues occur. All manual entries are logged with your admin ID.
        </div>

        <form id="manualEntryForm" onsubmit="submitManualEntry(event)">
            <!-- Student Selection -->
            <div class="form-section">
                <h4>üë§ Student Information</h4>
                <div class="form-group">
                    <label for="manualIdBadge">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 0.25rem;">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                        Student ID Badge:
                    </label>
                    <input type="text"
                           id="manualIdBadge"
                           placeholder="Enter 4-digit ID"
                           maxlength="4"
                           required
                           oninput="this.value = this.value.replace(/\D/g, '').slice(0, 4); if(this.value.length === 4) { validateManualBadge(this.value); } else { document.getElementById('manualBadgeValidation').innerHTML = ''; }">
                    <div id="manualBadgeValidation"></div>
                </div>
            </div>

            <!-- Entry Type Selection -->
            <div class="form-section">
                <h4>üìã Entry Type</h4>
                <div class="form-group">
                    <label>Select entry type:</label>
                    <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; padding: 0.75rem; border: 2px solid var(--border-color); border-radius: var(--border-radius-lg); flex: 1;">
                            <input type="radio" name="entryType" id="entryTypeTimeIn" value="timeIn" checked onchange="toggleCompleteEntry()">
                            <div>
                                <strong>Time-In Only</strong>
                                <small style="display: block; color: var(--text-muted);">Student will time-out later</small>
                            </div>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; padding: 0.75rem; border: 2px solid var(--border-color); border-radius: var(--border-radius-lg); flex: 1;">
                            <input type="radio" name="entryType" id="entryTypeComplete" value="complete" onchange="toggleCompleteEntry()">
                            <div>
                                <strong>Complete Entry</strong>
                                <small style="display: block; color: var(--text-muted);">Both time-in and time-out</small>
                            </div>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Time Entry -->
            <div class="form-section">
                <h4>‚è∞ Time Information</h4>
                <div class="form-grid">
                    <!-- Time In -->
                    <div class="form-group">
                        <label for="manualTimeIn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 0.25rem;">
                                <circle cx="12" cy="12" r="10"></circle>
                                <polyline points="12 6 12 12 16 14"></polyline>
                            </svg>
                            Time In:
                        </label>
                        <input type="datetime-local" id="manualTimeIn" required>
                        <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                            <button type="button" class="btn btn-sm btn-secondary" onclick="setQuickTime('in', 'now')">Now</button>
                            <button type="button" class="btn btn-sm btn-secondary" onclick="setQuickTime('in', '6am')">6:00 AM</button>
                            <button type="button" class="btn btn-sm btn-secondary" onclick="setQuickTime('in', '8am')">8:00 AM</button>
                            <button type="button" class="btn btn-sm btn-secondary" onclick="setQuickTime('in', '10am')">10:00 AM</button>
                            <button type="button" class="btn btn-sm btn-secondary" onclick="setQuickTime('in', '12pm')">12:00 AM</button>
                        </div>
                    </div>

                    <!-- Time Out (conditional) -->
                    <div class="form-group" id="manualTimeOutGroup" style="display: none;">
                        <label for="manualTimeOut">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 0.25rem;">
                                <circle cx="12" cy="12" r="10"></circle>
                                <polyline points="12 6 12 12 16 14"></polyline>
                            </svg>
                            Time Out:
                        </label>
                        <input type="datetime-local" id="manualTimeOut">
                        <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                            <button type="button" class="btn btn-sm btn-secondary" onclick="setQuickTime('out', 'now')">Now</button>
                            <button type="button" class="btn btn-sm btn-secondary" onclick="setQuickTime('out', '3pm')">3:00 PM</button>
                            <button type="button" class="btn btn-sm btn-secondary" onclick="setQuickTime('out', '5pm')">5:00 PM</button>
                            <button type="button" class="btn btn-sm btn-secondary" onclick="setQuickTime('out', '7pm')">7:00 PM</button>
                            <button type="button" class="btn btn-sm btn-secondary" onclick="setQuickTime('out', '9pm')">9:00 PM</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tasks (conditional) -->
            <div class="form-section" id="manualTasksGroup" style="display: none;">
                <h4>üìù Tasks Completed (Optional)</h4>
                <div class="form-group">
                    <label for="manualTasks">Tasks completed during this time:</label>
                    <textarea id="manualTasks"
                              placeholder="e.g., Completed coding tasks, attended team meetings, worked on documentation..."
                              rows="3"></textarea>
                    <small>This will be logged as the student's task entry for this session</small>
                </div>
            </div>

            <!-- Admin Reason -->
            <div class="form-section">
                <h4>üìÑ Admin Justification</h4>
                <div class="form-group">
                    <label for="manualReason">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 0.25rem;">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="16" x2="12" y2="12"></line>
                            <line x1="12" y1="8" x2="12.01" y2="8"></line>
                        </svg>
                        Reason for manual entry:
                    </label>
                    <textarea id="manualReason"
                              placeholder="e.g., Student forgot to time-in due to internet issues, Power outage during work hours, System was down..."
                              rows="3"
                              required></textarea>
                    <small>This reason will be permanently recorded for audit purposes</small>
                </div>
            </div>

            <div class="alert alert-warning">
                <strong>‚ö†Ô∏è Important:</strong> Manual entries are permanently logged with your admin account. Ensure all information is accurate before submitting.
            </div>

            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="closeModal('manualEntryModal')">
                    Cancel
                </button>
                <button type="submit" class="btn btn-warning">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                    Create Manual Entry
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Manual Entry Confirmation Modal -->
<div id="manualEntryConfirmModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Confirm Manual Entry</h3>
            <button class="modal-close" onclick="closeModal('manualEntryConfirmModal')">√ó</button>
        </div>

        <div id="manualEntryConfirmContent">
            <!-- Content will be dynamically loaded -->
        </div>

        <div class="modal-actions">
            <button class="btn btn-secondary" onclick="closeModal('manualEntryConfirmModal')">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
                Cancel
            </button>
            <button class="btn btn-warning" onclick="executeManualEntry()">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
                Confirm & Create Entry
            </button>
        </div>
    </div>
</div>

<!-- Manual Entry Result Modal -->
<div id="manualEntryResultModal" class="modal">
    <div class="modal-content">
        <div id="manualEntryResultContent">
            <!-- Content will be dynamically loaded -->
        </div>
    </div>
</div>

<!-- Schedule Override Review Modal -->
<div id="overrideReviewModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="overrideReviewTitle">Review Schedule Override</h3>
            <button class="modal-close" onclick="closeModal('overrideReviewModal')">√ó</button>
        </div>

        <div class="student-detail">
            <h4>Request Details</h4>
            <div class="detail-grid">
                <div class="detail-item">
                    <div class="detail-label">Student</div>
                    <div class="detail-value"><strong id="overrideStudentName">-</strong></div>
                </div>
            </div>
        </div>

        <form id="overrideReviewForm" onsubmit="submitOverrideReview(event)">
            <div class="form-group">
                <label for="overrideAdminResponse">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 0.25rem;">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                    Message to Student:
                </label>
                <textarea id="overrideAdminResponse"
                          placeholder="Optional: Add a message to the student"
                          rows="3"></textarea>
                <small>This message will be visible to the student when they check their request status</small>
            </div>

            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="closeModal('overrideReviewModal')">
                    Cancel
                </button>
                <button type="submit" class="btn btn-primary">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                    Submit Review
                </button>
            </div>
        </form>
    </div>
</div>

<div class="live-task-loading" id="liveTaskLoadingIndicator">
    <div class="spinner"></div>
    <span>Updating tasks...</span>
</div>

<div id="loading" class="loading">
    <div class="spinner"></div>
    <p>Loading...</p>
</div>

<script src="notification.js"></script>
<script src="admin.js"></script>
</body>
</html>